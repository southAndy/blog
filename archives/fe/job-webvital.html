<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>效能優化筆記 | Andy walking</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="try to write some articles">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.6bbf80a7.js" as="script"><link rel="preload" href="/assets/js/2.3dc1b8de.js" as="script"><link rel="preload" href="/assets/js/1.7f771cfb.js" as="script"><link rel="preload" href="/assets/js/34.a25d4ed9.js" as="script"><link rel="prefetch" href="/assets/js/10.23a1f579.js"><link rel="prefetch" href="/assets/js/11.c389195a.js"><link rel="prefetch" href="/assets/js/12.1d996921.js"><link rel="prefetch" href="/assets/js/13.11b1ca6a.js"><link rel="prefetch" href="/assets/js/14.37ef2a72.js"><link rel="prefetch" href="/assets/js/15.5542c093.js"><link rel="prefetch" href="/assets/js/16.d48fd1ce.js"><link rel="prefetch" href="/assets/js/17.bd8d538c.js"><link rel="prefetch" href="/assets/js/18.6d3b94c1.js"><link rel="prefetch" href="/assets/js/19.eb35cfee.js"><link rel="prefetch" href="/assets/js/20.c11ec329.js"><link rel="prefetch" href="/assets/js/21.db1b5d88.js"><link rel="prefetch" href="/assets/js/22.5a81c169.js"><link rel="prefetch" href="/assets/js/23.1a532dfa.js"><link rel="prefetch" href="/assets/js/24.e4cae997.js"><link rel="prefetch" href="/assets/js/25.01cc8187.js"><link rel="prefetch" href="/assets/js/26.30bea54f.js"><link rel="prefetch" href="/assets/js/27.99b715ff.js"><link rel="prefetch" href="/assets/js/28.ed24d7fb.js"><link rel="prefetch" href="/assets/js/29.55f9986e.js"><link rel="prefetch" href="/assets/js/3.5322f14a.js"><link rel="prefetch" href="/assets/js/30.d8a766cf.js"><link rel="prefetch" href="/assets/js/31.c5f0745b.js"><link rel="prefetch" href="/assets/js/32.9588f179.js"><link rel="prefetch" href="/assets/js/33.707322a4.js"><link rel="prefetch" href="/assets/js/35.2efcf8b4.js"><link rel="prefetch" href="/assets/js/36.bacece6e.js"><link rel="prefetch" href="/assets/js/37.129a7cf8.js"><link rel="prefetch" href="/assets/js/38.617142bd.js"><link rel="prefetch" href="/assets/js/39.6aa441d2.js"><link rel="prefetch" href="/assets/js/4.84e1e480.js"><link rel="prefetch" href="/assets/js/5.f0541060.js"><link rel="prefetch" href="/assets/js/6.dfb06aa0.js"><link rel="prefetch" href="/assets/js/7.7551a9fb.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Andy walking</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/fe/bundler/" class="nav-link">
  打包
</a></li><li class="dropdown-item"><!----> <a href="/archives/fe/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/archives/fe/vuejs/" class="nav-link">
  vuejs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="後端" class="dropdown-title"><span class="title">後端</span> <span class="arrow down"></span></button> <button type="button" aria-label="後端" class="mobile-dropdown-title"><span class="title">後端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/be/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/database/" class="nav-link">
  資料庫
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/crawler/" class="nav-link">
  爬蟲
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/archives/others/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/fe/bundler/" class="nav-link">
  打包
</a></li><li class="dropdown-item"><!----> <a href="/archives/fe/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/archives/fe/vuejs/" class="nav-link">
  vuejs
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="後端" class="dropdown-title"><span class="title">後端</span> <span class="arrow down"></span></button> <button type="button" aria-label="後端" class="mobile-dropdown-title"><span class="title">後端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/archives/be/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/database/" class="nav-link">
  資料庫
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/crawler/" class="nav-link">
  爬蟲
</a></li><li class="dropdown-item"><!----> <a href="/archives/be/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/archives/others/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Fe</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/archives/fe/" aria-current="page" class="sidebar-link">/archives/fe/</a></li><li><a href="/archives/fe/job-webvital.html" aria-current="page" class="active sidebar-link">效能優化筆記</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="執行前的評估"><a href="#執行前的評估" class="header-anchor">#</a> 執行前的評估</h2> <p>在開始做優化之前，可以先思考以下兩點</p> <ol><li>應用程式需要追求效能嗎？</li> <li>投入的時間成本</li> <li>執行難易度</li></ol> <h2 id="效能優化實例"><a href="#效能優化實例" class="header-anchor">#</a> 效能優化實例</h2> <p>其實優化分很多的面向，在這篇文章提及的主要取向為：<strong>效能（Performance）方面的優化</strong></p> <h3 id="設定-gzip-壓縮體積"><a href="#設定-gzip-壓縮體積" class="header-anchor">#</a> 設定 gzip 壓縮體積</h3> <p>在筆者的案例是在 nginx 上設定壓縮的，附上程式碼</p> <div class="language-shell extra-class"><pre class="language-shell"><code>    <span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment">#啟動 gzip</span>
    gzip_disable <span class="token string">&quot;msie6&quot;</span><span class="token punctuation">;</span> <span class="token comment">#不要對 IE6 做處理</span>
    gzip_types <span class="token comment">#對哪些檔案進行處理</span>
		text/xml
		text/css
		text/plain
		<span class="token comment"># ....</span>
</code></pre></div><h3 id="檢視並移除未使用的元件"><a href="#檢視並移除未使用的元件" class="header-anchor">#</a> 檢視並移除未使用的元件</h3> <p>若沒有定期整理專案程式碼，在功能迭代過程可能會誕生暫時應付性元件，將這些內容移除也能稍微縮小打包的體積。</p> <h3 id="將圖檔由-png-改為-webp"><a href="#將圖檔由-png-改為-webp" class="header-anchor">#</a> 將圖檔由 png 改為 webp</h3> <p>webp 是由 google 開發的，<strong>用來提供體積更小、但畫質相同的圖檔</strong>，以下是移轉過來前須考量：</p> <ol><li>使用者瀏覽器確認（ webp 對於 Safari , IE 的支援度相對比較低）</li> <li>圖片會有做成動畫的需求嗎？</li></ol> <h3 id="檢視第三方套件的使用狀態"><a href="#檢視第三方套件的使用狀態" class="header-anchor">#</a> 檢視第三方套件的使用狀態</h3> <p>在這邊是使用 webpack-bundle-analyzer 去檢視主要打包、及第三方套件打包（chunk-vendor）的體積、內部套件的使用狀況。</p> <h3 id="移除未使用的-css"><a href="#移除未使用的-css" class="header-anchor">#</a> 移除未使用的 css</h3> <p>在瀏覽器渲染畫面的過程，分別會產生 CSSOM 以及 DOM ，最終結合為 renderTree。css 的內容，不像 javascript 的程式碼，是可以透過 webpack 的 tree-shaking 機制去過濾無用的程式碼，<strong>所有 CSSOM 的內容（包含那些沒用到的 css)</strong> 都會被瀏覽器讀取，徒增體積、降低渲染速度。</p> <blockquote><p>那如何找到未使用的 css ？</p></blockquote> <p>在 chrome 的開發者工具點擊 <code>command + shift + P</code> 輸入 <code>coverage</code>，檔案標示紅色的，就是未被使用到的 css 樣式編譯內容。</p> <br> <h3 id="靜態資源快取"><a href="#靜態資源快取" class="header-anchor">#</a> 靜態資源快取</h3> <p>這邊是使用所謂的 server-side-cache ，在 nginx 為靜態資源加上快取設定</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* \.(png|jpg|jpeg|gif|svg|webp|js)$)</span>
<span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">expires</span> <span class="token number">8640000</span></span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;public&quot;</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~ ^/feature/js/index\.[a-zA-Z0-9]+\.js$)</span>
<span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-cache&quot;</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>使用正則表達判斷當檔案類型符合時，暫存這個內容 864000(s) 也就是 100 天。</p> <blockquote><p>注意：若是針對同名稱的靜態資源進行更新，會無法偵測內容有改變。</p></blockquote> <h3 id="升級-http2"><a href="#升級-http2" class="header-anchor">#</a> 升級 HTTP2</h3> <h4 id="升級有什麼好處"><a href="#升級有什麼好處" class="header-anchor">#</a> 升級有什麼好處</h4> <p>HTTP/1.1 有一個非常大的缺陷是每個對伺服器的 Request 資源請求，都必須佔用一個網路連線（TCP connection），瀏覽器無法同時下載，這件事情在 HTTP/2 獲得了改善。<strong>簡單來說 HTTP2 讓你的網頁載入更快、更安全。</strong></p> <h2 id="小結"><a href="#小結" class="header-anchor">#</a> 小結</h2> <p>比起透過 code splitting 那類的優化，這些調整是相對容易又能讓效能提升稍微有感的做法，不過與其追求事後的優化，不然事情就定期監測自身專案的效能狀況，正所謂「預防重於治療」在下一篇會想試著介紹 lighthouse-ci 自動效能監測的功能。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/archives/fe/" class="prev router-link-active">
        /archives/fe/
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6bbf80a7.js" defer></script><script src="/assets/js/2.3dc1b8de.js" defer></script><script src="/assets/js/1.7f771cfb.js" defer></script><script src="/assets/js/34.a25d4ed9.js" defer></script>
  </body>
</html>
