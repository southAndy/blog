(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{312:function(t,s,a){"use strict";a.r(s);var e=a(14),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"執行前的評估"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#執行前的評估"}},[t._v("#")]),t._v(" 執行前的評估")]),t._v(" "),s("p",[t._v("在開始做優化之前，可以先思考以下兩點")]),t._v(" "),s("ol",[s("li",[t._v("應用程式需要追求效能嗎？")]),t._v(" "),s("li",[t._v("投入的時間成本")]),t._v(" "),s("li",[t._v("執行難易度")])]),t._v(" "),s("h2",{attrs:{id:"效能優化實例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#效能優化實例"}},[t._v("#")]),t._v(" 效能優化實例")]),t._v(" "),s("p",[t._v("其實優化分很多的面向，在這篇文章提及的主要取向為："),s("strong",[t._v("效能（Performance）方面的優化")])]),t._v(" "),s("h3",{attrs:{id:"設定-gzip-壓縮體積"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#設定-gzip-壓縮體積"}},[t._v("#")]),t._v(" 設定 gzip 壓縮體積")]),t._v(" "),s("p",[t._v("在筆者的案例是在 nginx 上設定壓縮的，附上程式碼")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#啟動 gzip")]),t._v("\n    gzip_disable "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msie6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不要對 IE6 做處理")]),t._v("\n    gzip_types "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#對哪些檔案進行處理")]),t._v("\n\t\ttext/xml\n\t\ttext/css\n\t\ttext/plain\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ....")]),t._v("\n")])])]),s("h3",{attrs:{id:"檢視並移除未使用的元件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#檢視並移除未使用的元件"}},[t._v("#")]),t._v(" 檢視並移除未使用的元件")]),t._v(" "),s("p",[t._v("若沒有定期整理專案程式碼，在功能迭代過程可能會誕生暫時應付性元件，將這些內容移除也能稍微縮小打包的體積。")]),t._v(" "),s("h3",{attrs:{id:"將圖檔由-png-改為-webp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#將圖檔由-png-改為-webp"}},[t._v("#")]),t._v(" 將圖檔由 png 改為 webp")]),t._v(" "),s("p",[t._v("webp 是由 google 開發的，"),s("strong",[t._v("用來提供體積更小、但畫質相同的圖檔")]),t._v("，以下是移轉過來前須考量：")]),t._v(" "),s("ol",[s("li",[t._v("使用者瀏覽器確認（ webp 對於 Safari , IE 的支援度相對比較低）")]),t._v(" "),s("li",[t._v("圖片會有做成動畫的需求嗎？")])]),t._v(" "),s("h3",{attrs:{id:"檢視第三方套件的使用狀態"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#檢視第三方套件的使用狀態"}},[t._v("#")]),t._v(" 檢視第三方套件的使用狀態")]),t._v(" "),s("p",[t._v("在這邊是使用 webpack-bundle-analyzer 去檢視主要打包、及第三方套件打包（chunk-vendor）的體積、內部套件的使用狀況。")]),t._v(" "),s("h3",{attrs:{id:"移除未使用的-css"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#移除未使用的-css"}},[t._v("#")]),t._v(" 移除未使用的 css")]),t._v(" "),s("p",[t._v("在瀏覽器渲染畫面的過程，分別會產生 CSSOM 以及 DOM ，最終結合為 renderTree。css 的內容，不像 javascript 的程式碼，是可以透過 webpack 的 tree-shaking 機制去過濾無用的程式碼，"),s("strong",[t._v("所有 CSSOM 的內容（包含那些沒用到的 css)")]),t._v(" 都會被瀏覽器讀取，徒增體積、降低渲染速度。")]),t._v(" "),s("blockquote",[s("p",[t._v("那如何找到未使用的 css ？")])]),t._v(" "),s("p",[t._v("在 chrome 的開發者工具點擊 "),s("code",[t._v("command + shift + P")]),t._v(" 輸入 "),s("code",[t._v("coverage")]),t._v("，檔案標示紅色的，就是未被使用到的 css 樣式編譯內容。")]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"靜態資源快取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#靜態資源快取"}},[t._v("#")]),t._v(" 靜態資源快取")]),t._v(" "),s("p",[t._v("這邊是使用所謂的 server-side-cache ，在 nginx 為靜態資源加上快取設定")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(" ~* \\.(png|jpg|jpeg|gif|svg|webp|js)$)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8640000")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache-Control "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"public"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(" ~ ^/feature/js/index\\.[a-zA-Z0-9]+\\.js$)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache-Control "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no-cache"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("使用正則表達判斷當檔案類型符合時，暫存這個內容 864000(s) 也就是 100 天。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：若是針對同名稱的靜態資源進行更新，會無法偵測內容有改變。")])]),t._v(" "),s("h3",{attrs:{id:"升級-http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升級-http2"}},[t._v("#")]),t._v(" 升級 HTTP2")]),t._v(" "),s("h4",{attrs:{id:"升級有什麼好處"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升級有什麼好處"}},[t._v("#")]),t._v(" 升級有什麼好處")]),t._v(" "),s("p",[t._v("HTTP/1.1 有一個非常大的缺陷是每個對伺服器的 Request 資源請求，都必須佔用一個網路連線（TCP connection），瀏覽器無法同時下載，這件事情在 HTTP/2 獲得了改善。"),s("strong",[t._v("簡單來說 HTTP2 讓你的網頁載入更快、更安全。")])]),t._v(" "),s("h2",{attrs:{id:"小結"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小結"}},[t._v("#")]),t._v(" 小結")]),t._v(" "),s("p",[t._v("比起透過 code splitting 那類的優化，這些調整是相對容易又能讓效能提升稍微有感的做法，不過與其追求事後的優化，不然事情就定期監測自身專案的效能狀況，正所謂「預防重於治療」在下一篇會想試著介紹 lighthouse-ci 自動效能監測的功能。")])])}),[],!1,null,null,null);s.default=r.exports}}]);